<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>ãƒ‹ãƒ¥ãƒ¼ã‚¨ã‚¯ã‚¹ãƒ—ãƒ¬ã‚¹ãƒˆãƒ«ã‚³èªï½œå‹•è©æ´»ç”¨ å®Œå…¨ç‰ˆ</title>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  margin: 0;
  background: #f9f9f9;
  line-height: 1.6;
}
.header {
  position: sticky;
  top: 0;
  background: #fff;
  border-bottom: 1px solid #ddd;
  padding: 8px;
  z-index: 10;
}
.container {
  max-width: 640px;
  margin: auto;
  padding: 12px;
}
h1 { text-align: center; font-size: 1.2em; }

select, button {
  width: 100%;
  padding: 14px;
  margin: 6px 0;
  font-size: 1em;
  border-radius: 10px;
}

.question {
  font-size: 1.3em;
  font-weight: bold;
  text-align: center;
  margin: 16px 0;
}

.choiceBtn { background:#eee; border:none; }
.choiceBtn.correct { background:#c8f7c5; }
.choiceBtn.wrong { background:#f7c5c5; }

#exampleBox {
  margin-top: 12px;
  padding: 10px;
  background: #fff;
  border-radius: 8px;
  display: none;
}

@media (prefers-color-scheme: dark) {
  body { background:#121212; color:#f0f0f0; }
  .header, #exampleBox { background:#1e1e1e; }
  button { background:#333; color:#fff; }
}
</style>
</head>

<body>
<div class="header">
  <h1>ğŸ‡¹ğŸ‡· å‹•è©æ´»ç”¨ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ï¼ˆå®Œå…¨ç‰ˆï¼‰</h1>
  <select id="lessonSelect"></select>
</div>

<div class="container">
  <div class="question" id="question"></div>
  <div id="choices"></div>
  <button id="nextBtn">æ¬¡ã¸</button>
  <button id="toggleExample">ä¾‹æ–‡ã‚’è¦‹ã‚‹</button>
  <div id="exampleBox"></div>
</div>

<script>
/* ===== å…±é€š ===== */
const rand = a => a[Math.floor(Math.random()*a.length)];
const persons = ["ben","sen","o","biz","siz"];

/* ===== æ¯éŸ³èª¿å’Œ ===== */
const vowels = ["a","e","Ä±","i","o","Ã¶","u","Ã¼"];
const lastVowel = w => [...w].reverse().find(c=>vowels.includes(c));
const harmonyAE = w => ["e","i","Ã¶","Ã¼"].includes(lastVowel(w)) ? "e" : "a";
const harmonyI = w => {
  const v = lastVowel(w);
  if(["a","Ä±"].includes(v)) return "Ä±";
  if(["e","i"].includes(v)) return "i";
  if(["o","u"].includes(v)) return "u";
  return "Ã¼";
};

/* ===== å­éŸ³å¤‰åŒ– ===== */
const noSoftening = ["bakmak","Ã§Ä±kmak","akmak","korkmak"];
function soften(stem, vowel, verb){
  if(!vowel || noSoftening.includes(verb)) return stem;
  if(stem.endsWith("t")) return stem.slice(0,-1)+"d";
  if(stem.endsWith("k")) return stem.slice(0,-1)+"ÄŸ";
  return stem;
}

/* ===== ä¸è¦å‰‡ ===== */
const irregulars = {
  gitmek:{prog:"gid",fut:"gid",aor:"gid",past:"git"},
  yemek:{prog:"yiy",fut:"yiye",aor:"ye",past:"ye"},
  demek:{prog:"diy",fut:"diye",aor:"de",past:"de"},
  etmek:{prog:"ediy",fut:"ede",aor:"ed",past:"et"},
  olmak:{prog:"oluy",fut:"ola",aor:"ol",past:"ol"}
};

function stem(v, form){
  const base = v.verb.replace(/mak$|mek$/,"");
  return irregulars[v.verb]?.[form] || base;
}

/* ===== å‹•è© ===== */
const verbs = [
  {verb:"olmak",jp:"ã€œã§ã‚ã‚‹"},
  {verb:"yapmak",jp:"ã™ã‚‹"},
  {verb:"gitmek",jp:"è¡Œã"},
  {verb:"gelmek",jp:"æ¥ã‚‹"},
  {verb:"okumak",jp:"èª­ã‚€"},
  {verb:"Ã§alÄ±ÅŸmak",jp:"åƒã"},
  {verb:"yemek",jp:"é£Ÿã¹ã‚‹"},
  {verb:"iÃ§mek",jp:"é£²ã‚€"},
  {verb:"almak",jp:"è²·ã†"},
  {verb:"vermek",jp:"ä¸ãˆã‚‹"},
  {verb:"sevmek",jp:"å¥½ãã "},
  {verb:"istemek",jp:"æ¬²ã—ã„"},
  {verb:"gÃ¶rmek",jp:"è¦‹ã‚‹"},
  {verb:"bilmek",jp:"çŸ¥ã£ã¦ã„ã‚‹"},
  {verb:"korkmak",jp:"æ€–ãŒã‚‹"},
  {verb:"hatÄ±rlamak",jp:"æ€ã„å‡ºã™"},
  {verb:"unutmak",jp:"å¿˜ã‚Œã‚‹"}
];

/* ===== æ–‡æ³•å½¢ï¼ˆä¾‹ï¼šé€²è¡Œãƒ»æœªæ¥ï¼‰ ===== */
const grammarForms = [
{
 id:"prog_pos", jp:"é€²è¡Œå½¢",
 persons,
 make:(v,p)=>{
  const s = soften(stem(v,"prog"),true,v.verb);
  const i = harmonyI(s);
  return {ben:`${s}${i}yorum`,sen:`${s}${i}yorsun`,o:`${s}${i}yor`,
          biz:`${s}${i}yoruz`,siz:`${s}${i}yorsunuz`}[p];
 }
},
{
 id:"fut_pos", jp:"æœªæ¥å½¢",
 persons,
 make:(v,p)=>{
  const s = soften(stem(v,"fut"),true,v.verb);
  const a = harmonyAE(s);
  return {ben:`${s}${a}ceÄŸim`,sen:`${s}${a}ceksin`,o:`${s}${a}cek`,
          biz:`${s}${a}ceÄŸiz`,siz:`${s}${a}ceksiniz`}[p];
 }
}
];

/* ===== èª² ===== */
const lessons = [
 {lesson:1,title:"ç¾åœ¨",verbs:["olmak","gitmek","gelmek","yapmak"],forms:["prog_pos"]},
 {lesson:2,title:"æœªæ¥",verbs:["gitmek","gelmek"],forms:["fut_pos"]}
];

/* ===== UI ===== */
const lessonSelect = document.getElementById("lessonSelect");
const qEl = document.getElementById("question");
const cEl = document.getElementById("choices");
const exEl = document.getElementById("exampleBox");

lessons.forEach(l=>{
  const o=document.createElement("option");
  o.value=l.lesson;
  o.textContent=`ç¬¬${l.lesson}èª²ï¼š${l.title}`;
  lessonSelect.appendChild(o);
});

let current=null;

function newQ(){
  const L=lessons.find(l=>l.lesson==lessonSelect.value);
  const v=verbs.find(x=>x.verb===rand(L.verbs));
  const g=grammarForms.find(x=>x.id===rand(L.forms));
  const p=rand(g.persons);
  const ans=g.make(v,p);
  current={ans};
  qEl.textContent=`${v.jp} / ${g.jp} / ${p}`;
  cEl.innerHTML="";
  const opts=[ans];
  while(opts.length<4){
    const o=g.make(v,rand(g.persons));
    if(!opts.includes(o)) opts.push(o);
  }
  opts.sort(()=>Math.random()-0.5);
  opts.forEach(o=>{
    const b=document.createElement("button");
    b.className="choiceBtn";
    b.textContent=o;
    b.onclick=()=>b.classList.add(o===ans?"correct":"wrong");
    cEl.appendChild(b);
  });
}

nextBtn.onclick=newQ;
lessonSelect.onchange=newQ;
lessonSelect.value=1;
newQ();
</script>
</body>
</html>
