<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Turkish Verb Conjugation Trainer</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
  background: #eefbf0;
  font-family: "Nunito", sans-serif;
  margin: 0;
  padding: 0;
  text-align: center;
  color: #222;
}

/* ---------- HEADER ---------- */
header {
  background: #58cc02;
  color: white;
  padding: 16px;
  font-size: 28px;
  font-weight: 700;
  box-shadow: 0 2px 4px #0002;
}

/* ---------- TAB BUTTONS ---------- */
.tabbar {
  display: flex;
  justify-content: space-around;
  background: #ffffff;
  padding: 10px 0;
  border-bottom: 2px solid #d5f5d8;
}

.tabbar button {
  font-size: 18px;
  padding: 8px 14px;
  border: none;
  border-radius: 12px;
  background: #dfffdc;
  color: #2f7d1e;
  font-weight: 600;
  cursor: pointer;
}

.tabbar button.active {
  background: #58cc02;
  color: white;
}

/* ---------- MAIN BOX ---------- */
.box {
  background: white;
  border-radius: 18px;
  padding: 24px;
  margin: 20px auto;
  width: 90%;
  max-width: 560px;
  box-shadow: 0 4px 10px #0001;
}

#question,
#question_input,
#mistakeQuestion {
  font-size: 22px;
  font-weight: bold;
  margin-bottom: 16px;
  line-height: 1.5;
}

/* ---------- CHOICE BUTTONS ---------- */
.choice {
  background: #fff;
  color: #444;
  border: 2px solid #cccccc;
  border-radius: 12px;
  padding: 14px;
  font-size: 18px;
  margin: 8px auto;
  width: 80%;
  max-width: 420px;
  cursor: pointer;
  transition: 0.2s;
}

.choice:hover {
  background: #e8ffe8;
}

/* ---------- EXAMPLE AREA ---------- */
.exampleBox {
  margin-top: 10px;
  padding: 10px 12px;
  border-radius: 12px;
  background: #f6fff7;
  border: 1px solid #cceccc;
  font-size: 14px;
  text-align: left;
  white-space: pre-line;
}

.exampleTitle {
  font-weight: 700;
  margin-bottom: 4px;
  color: #267800;
}

/* ---------- INPUT MODE ---------- */
.inputField {
  width: 80%;
  padding: 18px;
  font-size: 24px;
  border-radius: 12px;
  border: 2px solid #aaa;
  margin-bottom: 12px;
  text-align: center;
}

.tr-keys button {
  background: #fff;
  color: #58cc02;
  border: none;
  font-size: 22px;
  padding: 8px 12px;
  margin: 4px;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 2px 4px #0001;
}
.tr-keys button:hover {
  background: #eaffea;
}

/* ---------- ACTION BUTTONS ---------- */
.mainBtn {
  background: #58cc02;
  color: white;
  border: none;
  border-radius: 14px;
  padding: 12px 22px;
  font-size: 20px;
  font-weight: 700;
  cursor: pointer;
  margin: 8px;
}
.mainBtn:hover { background:#46a601 }

/* ---------- STATS ---------- */
.statbox {
  background: white;
  padding: 20px;
  width: 80%;
  margin: 20px auto;
  border-radius: 16px;
  box-shadow: 0 3px 8px #0002;
  text-align: left;
  font-size: 16px;
}

/* Animation for correct/incorrect */
.correctFlash { animation: correctAnim 0.4s; }
@keyframes correctAnim {
  from { background:#b7ffb7; }
  to { background:white; }
}
.wrongFlash { animation: wrongAnim 0.4s; }
@keyframes wrongAnim {
  from { background:#ffd2d2; }
  to { background:white; }
}
</style>
</head>

<body>

<header>Turkish Verb Conjugation Trainer</header>

<!-- TABS -->
<div class="tabbar">
  <button id="tabChoice" class="active">4æŠ</button>
  <button id="tabInput">å…¥åŠ›</button>
  <button id="tabStats">Stats</button>
  <button id="tabMistake">è‹¦æ‰‹å•é¡Œ</button>
  <button id="tabFilter">æ–‡æ³•å½¢</button>
</div>

<!-- QUIZ AREA -->
<div id="contentArea">

  <!-- 4æŠãƒ¢ãƒ¼ãƒ‰ -->
  <div id="choiceMode" class="box">
    <div id="question"></div>
    <div id="choices"></div>
    <div id="exampleChoice" class="exampleBox" style="display:none;"></div>
    <button class="mainBtn" id="nextBtn">æ¬¡ã¸</button>
  </div>

  <!-- å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ -->
  <div id="inputMode" class="box" style="display:none;">
    <div id="question_input"></div>
    <input type="text" id="inputAnswer" class="inputField" placeholder="æ´»ç”¨å½¢ã‚’ãƒˆãƒ«ã‚³èªã§å…¥åŠ›" />
    <div class="tr-keys">
      <button>Ã§</button><button>ÄŸ</button><button>Ä±</button><button>Ä°</button>
      <button>Ã¶</button><button>ÅŸ</button><button>Ã¼</button>
      <button>Ã‡</button><button>Ä</button><button>Ã–</button>
      <button>Å</button><button>Ãœ</button>
      <button>.</button><button>?</button>
    </div>
    <div id="exampleInput" class="exampleBox" style="display:none;"></div>
    <button class="mainBtn" id="inputCheck">ç­”ãˆã‚‹</button>
    <button class="mainBtn" id="inputNext">æ¬¡ã¸</button>
  </div>

  <!-- Stats -->
  <div id="statsMode" style="display:none;">
    <div class="statbox">
      <h2>ğŸ“Š Stats</h2>
      <p id="stat_total"></p>
      <p id="stat_correct"></p>
      <p id="stat_wrong"></p>
      <p id="stat_rate"></p>
      <h3>è‹¦æ‰‹å•é¡Œãƒªã‚¹ãƒˆï¼ˆæœ€å¤§10ï¼‰</h3>
      <ul id="stat_mistake"></ul>
    </div>
  </div>

  <!-- è‹¦æ‰‹å•é¡Œãƒ¢ãƒ¼ãƒ‰ -->
  <div id="mistakeMode" class="box" style="display:none;">
    <h3>è‹¦æ‰‹å•é¡Œãƒ¢ãƒ¼ãƒ‰</h3>
    <div id="mistakeInfo"></div>
    <div id="mistakeQuestion"></div>
    <div id="mistakeChoices"></div>
    <div id="exampleMistake" class="exampleBox" style="display:none;"></div>
    <button class="mainBtn" id="mistakeNext">æ¬¡ã¸</button>
  </div>

  <!-- æ–‡æ³•å½¢ãƒ•ã‚£ãƒ«ã‚¿ -->
  <div id="filterMode" class="box" style="display:none;">
    <h3>æ–‡æ³•å½¢ã§é¸ã¶</h3>
    <p style="font-size:14px;margin-top:0;">â€»åŒã˜æ–‡æ³•å½¢ã ã‘å‡ºé¡Œã—ãŸã„ã¨ãã«ä½¿ã„ã¾ã™ã€‚</p>
    <select id="posSelect" style="font-size:18px;padding:8px;border-radius:10px;">
      <option value="all">å…¨éƒ¨</option>
      <option value="prog_pos">é€²è¡Œå½¢ï¼ˆè‚¯å®šï¼‰</option>
      <option value="prog_neg">é€²è¡Œå½¢ï¼ˆå¦å®šï¼‰</option>
      <option value="fut_pos">æœªæ¥å½¢ï¼ˆè‚¯å®šï¼‰</option>
      <option value="fut_neg">æœªæ¥å½¢ï¼ˆå¦å®šï¼‰</option>
      <option value="past_pos">å®Œäº†å½¢ï¼ˆè‚¯å®šï¼‰</option>
      <option value="past_neg">å®Œäº†å½¢ï¼ˆå¦å®šï¼‰</option>
      <option value="rep_pos">ä¼èå®Œäº†å½¢ï¼ˆè‚¯å®šï¼‰</option>
      <option value="rep_neg">ä¼èå®Œäº†å½¢ï¼ˆå¦å®šï¼‰</option>
      <option value="aor_pos">ä¸­ç«‹å½¢ï¼ˆè‚¯å®šï¼‰</option>
      <option value="aor_neg">ä¸­ç«‹å½¢ï¼ˆå¦å®šï¼‰</option>
      <option value="abil_pos">å¯èƒ½ï¼ˆè‚¯å®šï¼‰</option>
      <option value="abil_neg">å¯èƒ½ï¼ˆå¦å®šï¼‰</option>
      <option value="opt">æ„å‘å½¢</option>
      <option value="imp_dir">å‘½ä»¤å½¢ï¼ˆç›´æ¥ï¼‰</option>
      <option value="imp_ind">å‘½ä»¤å½¢ï¼ˆé–“æ¥ï¼‰</option>
    </select>
    <div style="margin-top:16px;">
      <button class="mainBtn" id="filterStart">ã“ã®æ¡ä»¶ã§ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </div>
  </div>

</div>

<script>
// =====================
//  å‹•è©æ´»ç”¨ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
// =====================
// å¿…è¦ã«å¿œã˜ã¦ã€ã“ã®é…åˆ—ã«å•é¡Œã‚’ã©ã‚“ã©ã‚“è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
const vocab = [

  // ---- yap(mak) ã™ã‚‹ ----
  {
    id: "yap_prog_ben",
    q: "yapmakï¼ˆã™ã‚‹ï¼‰ / é€²è¡Œå½¢è‚¯å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "yapÄ±yorum",
    c: ["yapmÄ±yorum","yapacaÄŸÄ±m","yaparÄ±m"],
    verb: "yapmak",
    stem: "yap",
    jp: "ã™ã‚‹",
    form: "é€²è¡Œå½¢è‚¯å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "prog_pos",
    ex: "Ben ÅŸimdi yapÄ±yorum.\nï¼ˆç§ã¯ä»Šã€ã—ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ã€‚ï¼‰"
  },
  {
    id: "yap_prog_o",
    q: "yapmakï¼ˆã™ã‚‹ï¼‰ / é€²è¡Œå½¢è‚¯å®š / 3äººç§°å˜æ•°ï¼ˆoï¼‰ â†’ ?",
    a: "yapÄ±yor",
    c: ["yapmÄ±yor","yapacak","yapar"],
    verb: "yapmak",
    stem: "yap",
    jp: "ã™ã‚‹",
    form: "é€²è¡Œå½¢è‚¯å®š",
    person: "3äººç§°å˜æ•°ï¼ˆoï¼‰",
    pos: "prog_pos",
    ex: "O ÅŸimdi yapÄ±yor.\nï¼ˆå½¼ï¼å½¼å¥³ã¯ã„ã¾ã€ã—ã¦ã„ã¾ã™ã€‚ï¼‰"
  },
  {
    id: "yap_fut_ben",
    q: "yapmakï¼ˆã™ã‚‹ï¼‰ / æœªæ¥å½¢è‚¯å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "yapacaÄŸÄ±m",
    c: ["yapÄ±yorum","yapmam","yaparÄ±m"],
    verb: "yapmak",
    stem: "yap",
    jp: "ã™ã‚‹",
    form: "æœªæ¥å½¢è‚¯å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "fut_pos",
    ex: "YarÄ±n bunu yapacaÄŸÄ±m.\nï¼ˆæ˜æ—¥ã“ã‚Œã‚’ã™ã‚‹ã¤ã‚‚ã‚Šã§ã™ã€‚ï¼‰"
  },
  {
    id: "yap_aor_neg_ben",
    q: "yapmakï¼ˆã™ã‚‹ï¼‰ / ä¸­ç«‹å½¢å¦å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "yapmam",
    c: ["yapÄ±yorum","yapmayacaÄŸÄ±m","yaparÄ±m"],
    verb: "yapmak",
    stem: "yap",
    jp: "ã™ã‚‹",
    form: "ä¸­ç«‹å½¢å¦å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "aor_neg",
    ex: "Genelde bÃ¶yle bir ÅŸey yapmam.\nï¼ˆæ™®é€šã¯ã“ã‚“ãªã“ã¨ã¯ã—ã¾ã›ã‚“ã€‚ï¼‰"
  },

  // ---- gitmek è¡Œã ----
  {
    id: "git_prog_ben",
    q: "gitmekï¼ˆè¡Œãï¼‰ / é€²è¡Œå½¢è‚¯å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "gidiyorum",
    c: ["gitmiyorum","gideceÄŸim","giderim"],
    verb: "gitmek",
    stem: "git / gid",
    jp: "è¡Œã",
    form: "é€²è¡Œå½¢è‚¯å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "prog_pos",
    ex: "Okula gidiyorum.\nï¼ˆå­¦æ ¡ã«è¡Œã£ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ã€‚ï¼‰"
  },
  {
    id: "git_prog_neg_ben",
    q: "gitmekï¼ˆè¡Œãï¼‰ / é€²è¡Œå½¢å¦å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "gitmiyorum",
    c: ["gidiyorum","gitmeyeceÄŸim","gitmem"],
    verb: "gitmek",
    stem: "git / gid",
    jp: "è¡Œã",
    form: "é€²è¡Œå½¢å¦å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "prog_neg",
    ex: "BugÃ¼n okula gitmiyorum.\nï¼ˆä»Šæ—¥ã¯å­¦æ ¡ã«è¡Œã£ã¦ã„ã¾ã›ã‚“ï¼è¡Œãã¾ã›ã‚“ã€‚ï¼‰"
  },
  {
    id: "git_past_ben",
    q: "gitmekï¼ˆè¡Œãï¼‰ / å®Œäº†å½¢è‚¯å®šï¼ˆéå»ï¼‰ / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "gittim",
    c: ["gitmedim","gideceÄŸim","giderim"],
    verb: "gitmek",
    stem: "git",
    jp: "è¡Œã",
    form: "å®Œäº†å½¢è‚¯å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "past_pos",
    ex: "DÃ¼n sinemaya gittim.\nï¼ˆæ˜¨æ—¥ã€æ˜ ç”»é¤¨ã«è¡Œãã¾ã—ãŸã€‚ï¼‰"
  },
  {
    id: "git_aor_neg_ben",
    q: "gitmekï¼ˆè¡Œãï¼‰ / ä¸­ç«‹å½¢å¦å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "gitmem",
    c: ["gideceÄŸim","giderim","gitmiyorum"],
    verb: "gitmek",
    stem: "git",
    jp: "è¡Œã",
    form: "ä¸­ç«‹å½¢å¦å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "aor_neg",
    ex: "Genelde oraya gitmem.\nï¼ˆãµã ã‚“ã€ãã“ã«ã¯è¡Œãã¾ã›ã‚“ã€‚ï¼‰"
  },

  // ---- gelmek æ¥ã‚‹ ----
  {
    id: "gel_prog_ben",
    q: "gelmekï¼ˆæ¥ã‚‹ï¼‰ / é€²è¡Œå½¢è‚¯å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "geliyorum",
    c: ["gelmiyorum","geleceÄŸim","gelirim"],
    verb: "gelmek",
    stem: "gel",
    jp: "æ¥ã‚‹",
    form: "é€²è¡Œå½¢è‚¯å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "prog_pos",
    ex: "Ben ÅŸimdi geliyorum.\nï¼ˆä»Šã€è¡Œãã¾ã™ï¼å‘ã‹ã£ã¦ã„ã¾ã™ã€‚ï¼‰"
  },
  {
    id: "gel_fut_neg_ben",
    q: "gelmekï¼ˆæ¥ã‚‹ï¼‰ / æœªæ¥å½¢å¦å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "gelmeyeceÄŸim",
    c: ["geleceÄŸim","gelmiyorum","gelmem"],
    verb: "gelmek",
    stem: "gel",
    jp: "æ¥ã‚‹",
    form: "æœªæ¥å½¢å¦å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "fut_neg",
    ex: "YarÄ±n gelmeyeceÄŸim.\nï¼ˆæ˜æ—¥ã¯æ¥ãªã„ã¤ã‚‚ã‚Šã§ã™ã€‚ï¼‰"
  },

  // ---- sevmek å¥½ãã  ----
  {
    id: "sev_aor_ben",
    q: "sevmekï¼ˆå¥½ãã ï¼æ„›ã™ã‚‹ï¼‰ / ä¸­ç«‹å½¢è‚¯å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "severim",
    c: ["sevmem","seviyorum","seveceÄŸim"],
    verb: "sevmek",
    stem: "sev",
    jp: "å¥½ãã ï¼æ„›ã™ã‚‹",
    form: "ä¸­ç«‹å½¢è‚¯å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "aor_pos",
    ex: "TÃ¼rkÃ§eyi severim.\nï¼ˆãƒˆãƒ«ã‚³èªãŒå¥½ãã§ã™ã€‚ï¼‰"
  },
  {
    id: "sev_aor_neg_ben",
    q: "sevmekï¼ˆå¥½ãã ï¼æ„›ã™ã‚‹ï¼‰ / ä¸­ç«‹å½¢å¦å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "sevmem",
    c: ["severim","seviyorum","seveceÄŸim"],
    verb: "sevmek",
    stem: "sev",
    jp: "å¥½ãã ï¼æ„›ã™ã‚‹",
    form: "ä¸­ç«‹å½¢å¦å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "aor_neg",
    ex: "Bunu hiÃ§ sevmem.\nï¼ˆã“ã‚Œã¯å…¨ç„¶å¥½ãã˜ã‚ƒã‚ã‚Šã¾ã›ã‚“ã€‚ï¼‰"
  },

  // ---- Ã§alÄ±ÅŸmak åƒã / å‹‰å¼·ã™ã‚‹ ----
  {
    id: "calis_prog_ben",
    q: "Ã§alÄ±ÅŸmakï¼ˆåƒãï¼å‹‰å¼·ã™ã‚‹ï¼‰ / é€²è¡Œå½¢è‚¯å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "Ã§alÄ±ÅŸÄ±yorum",
    c: ["Ã§alÄ±ÅŸmÄ±yorum","Ã§alÄ±ÅŸacaÄŸÄ±m","Ã§alÄ±ÅŸÄ±rÄ±m"],
    verb: "Ã§alÄ±ÅŸmak",
    stem: "Ã§alÄ±ÅŸ",
    jp: "åƒãï¼å‹‰å¼·ã™ã‚‹",
    form: "é€²è¡Œå½¢è‚¯å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "prog_pos",
    ex: "Åimdi ders Ã§alÄ±ÅŸÄ±yorum.\nï¼ˆä»Šã€å‹‰å¼·ã—ã¦ã„ã¾ã™ã€‚ï¼‰"
  },
  {
    id: "calis_abil_neg_ben",
    q: "Ã§alÄ±ÅŸmakï¼ˆåƒãï¼å‹‰å¼·ã™ã‚‹ï¼‰ / å¯èƒ½ä¸­ç«‹å½¢å¦å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "Ã§alÄ±ÅŸamam",
    c: ["Ã§alÄ±ÅŸabilirim","Ã§alÄ±ÅŸmÄ±yorum","Ã§alÄ±ÅŸmam"],
    verb: "Ã§alÄ±ÅŸmak",
    stem: "Ã§alÄ±ÅŸ",
    jp: "åƒãï¼å‹‰å¼·ã™ã‚‹",
    form: "å¯èƒ½ä¸­ç«‹å½¢å¦å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "abil_neg",
    ex: "BugÃ¼n Ã§ok yorgunum, Ã§alÄ±ÅŸamam.\nï¼ˆä»Šæ—¥ã¯ã¨ã¦ã‚‚ç–²ã‚Œã¦ã„ã¦ã€å‹‰å¼·ï¼ä»•äº‹ãŒã§ãã¾ã›ã‚“ã€‚ï¼‰"
  },

  // ---- yemek é£Ÿã¹ã‚‹ ----
  {
    id: "ye_prog_ben",
    q: "yemekï¼ˆé£Ÿã¹ã‚‹ï¼‰ / é€²è¡Œå½¢è‚¯å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "yiyorum",
    c: ["yemiyorum","yiyeceÄŸim","yerim"],
    verb: "yemek",
    stem: "ye",
    jp: "é£Ÿã¹ã‚‹",
    form: "é€²è¡Œå½¢è‚¯å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "prog_pos",
    ex: "Åimdi yemek yiyorum.\nï¼ˆä»Šã€ã”é£¯ã‚’é£Ÿã¹ã¦ã„ã¾ã™ã€‚ï¼‰"
  },
  {
    id: "ye_fut_pos_ben",
    q: "yemekï¼ˆé£Ÿã¹ã‚‹ï¼‰ / æœªæ¥å½¢è‚¯å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "yiyeceÄŸim",
    c: ["yiyorum","yemeyeceÄŸim","yerim"],
    verb: "yemek",
    stem: "ye",
    jp: "é£Ÿã¹ã‚‹",
    form: "æœªæ¥å½¢è‚¯å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "fut_pos",
    ex: "AkÅŸam dÄ±ÅŸarÄ±da yiyeceÄŸim.\nï¼ˆå¤œã¯å¤–ã§é£Ÿã¹ã‚‹ã¤ã‚‚ã‚Šã§ã™ã€‚ï¼‰"
  },

  // ---- iÃ§mek é£²ã‚€ ----
  {
    id: "ic_prog_ben",
    q: "iÃ§mekï¼ˆé£²ã‚€ï¼‰ / é€²è¡Œå½¢è‚¯å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "iÃ§iyorum",
    c: ["iÃ§miyorum","iÃ§eceÄŸim","iÃ§erim"],
    verb: "iÃ§mek",
    stem: "iÃ§",
    jp: "é£²ã‚€",
    form: "é€²è¡Œå½¢è‚¯å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "prog_pos",
    ex: "Ã‡ay iÃ§iyorum.\nï¼ˆãƒãƒ£ã‚¤ã‚’é£²ã‚“ã§ã„ã¾ã™ã€‚ï¼‰"
  },

  // ---- istemek ã€œã—ãŸã„ ----
  {
    id: "iste_prog_ben",
    q: "istemekï¼ˆã€œã—ãŸã„ï¼æ¬²ã—ã„ï¼‰ / é€²è¡Œå½¢è‚¯å®š / 1äººç§°å˜æ•°ï¼ˆbenï¼‰ â†’ ?",
    a: "istiyorum",
    c: ["istemiyorum","isteyeceÄŸim","isterim"],
    verb: "istemek",
    stem: "iste",
    jp: "ã€œã—ãŸã„ï¼æ¬²ã—ã„",
    form: "é€²è¡Œå½¢è‚¯å®š",
    person: "1äººç§°å˜æ•°ï¼ˆbenï¼‰",
    pos: "prog_pos",
    ex: "TÃ¼rkÃ§e Ã¶ÄŸrenmek istiyorum.\nï¼ˆãƒˆãƒ«ã‚³èªã‚’å­¦ã³ãŸã„ã§ã™ã€‚ï¼‰"
  }

];

// =====================
//  STATE
// =====================
let current = null;
let mode = "choice";
let filteredList = [...vocab];
let mistakeList = JSON.parse(localStorage.getItem("conj_mistakeList") || "[]");

// Stats
let total   = Number(localStorage.getItem("conj_total")   || 0);
let correct = Number(localStorage.getItem("conj_correct") || 0);
let wrong   = Number(localStorage.getItem("conj_wrong")   || 0);

// DOM refs
const tabChoice  = document.getElementById("tabChoice");
const tabInput   = document.getElementById("tabInput");
const tabStats   = document.getElementById("tabStats");
const tabMistake = document.getElementById("tabMistake");
const tabFilter  = document.getElementById("tabFilter");

const question        = document.getElementById("question");
const choices         = document.getElementById("choices");
const exampleChoice   = document.getElementById("exampleChoice");

const question_input  = document.getElementById("question_input");
const inputAnswer     = document.getElementById("inputAnswer");
const exampleInput    = document.getElementById("exampleInput");

const stat_total      = document.getElementById("stat_total");
const stat_correct    = document.getElementById("stat_correct");
const stat_wrong      = document.getElementById("stat_wrong");
const stat_rate       = document.getElementById("stat_rate");
const stat_mistake    = document.getElementById("stat_mistake");

const mistakeInfo     = document.getElementById("mistakeInfo");
const mistakeQuestion = document.getElementById("mistakeQuestion");
const mistakeChoices  = document.getElementById("mistakeChoices");
const exampleMistake  = document.getElementById("exampleMistake");

const posSelect       = document.getElementById("posSelect");
const choiceModeBox   = document.getElementById("choiceMode");
const inputModeBox    = document.getElementById("inputMode");
const statsModeBox    = document.getElementById("statsMode");
const mistakeModeBox  = document.getElementById("mistakeMode");
const filterModeBox   = document.getElementById("filterMode");

// =====================
//  TAB SWITCHING
// =====================
function showTab(name){
  mode = name;

  choiceModeBox.style.display  = (name==="choice")  ? "block" : "none";
  inputModeBox.style.display   = (name==="input")   ? "block" : "none";
  statsModeBox.style.display   = (name==="stats")   ? "block" : "none";
  mistakeModeBox.style.display = (name==="mistake") ? "block" : "none";
  filterModeBox.style.display  = (name==="filter")  ? "block" : "none";

  document.querySelectorAll(".tabbar button").forEach(btn=>btn.classList.remove("active"));
  if(name==="choice")  tabChoice.classList.add("active");
  if(name==="input")   tabInput.classList.add("active");
  if(name==="stats")   tabStats.classList.add("active");
  if(name==="mistake") tabMistake.classList.add("active");
  if(name==="filter")  tabFilter.classList.add("active");

  if(name==="stats")   drawStats();
  if(name==="mistake") newMistakeQuestion();
}

tabChoice.onclick  = ()=>{ showTab("choice");  newQuestion(); };
tabInput.onclick   = ()=>{ showTab("input");   newInputQuestion(); };
tabStats.onclick   = ()=>{ showTab("stats"); };
tabMistake.onclick = ()=>{ showTab("mistake"); };
tabFilter.onclick  = ()=>{ showTab("filter"); };

// =====================
//  HELPERS
// =====================
function pickRandom(list){
  return list[Math.floor(Math.random()*list.length)];
}

function flash(id, cls){
  const box = document.getElementById(id);
  box.classList.add(cls);
  setTimeout(()=>box.classList.remove(cls),400);
}

function showExample(boxEl){
  if(!current || !current.ex){
    boxEl.style.display = "none";
    boxEl.innerHTML = "";
    return;
  }
  boxEl.style.display = "block";
  boxEl.innerHTML = `<div class="exampleTitle">ğŸ“– ä¾‹æ–‡</div>${current.ex}`;
}

// =====================
//  4æŠãƒ¢ãƒ¼ãƒ‰
// =====================
function newQuestion(){
  if(filteredList.length === 0){
    question.innerText = "å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚vocab é…åˆ—ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚";
    choices.innerHTML = "";
    exampleChoice.style.display = "none";
    return;
  }

  current = pickRandom(filteredList);
  question.innerText = current.q;
  exampleChoice.style.display = "none";
  exampleChoice.innerHTML = "";

  const arr = [current.a, ...current.c].sort(()=>Math.random()-0.5);
  choices.innerHTML = "";

  arr.forEach(ans=>{
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.innerText = ans;
    btn.onclick = ()=>checkChoice(ans);
    choices.appendChild(btn);
  });
}

function checkChoice(ans){
  total++;

  if(ans === current.a){
    correct++;
    flash("choiceMode","correctFlash");
    showExample(exampleChoice);
    setTimeout(()=>{ newQuestion(); }, 700);
  } else {
    wrong++;
    flash("choiceMode","wrongFlash");
    showExample(exampleChoice);
    addMistake(current.id || current.q);
  }

  saveStats();
}

document.getElementById("nextBtn").onclick = newQuestion;

// =====================
//  å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰
// =====================
function newInputQuestion(){
  if(filteredList.length === 0){
    question_input.innerText = "å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚vocab é…åˆ—ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚";
    return;
  }
  current = pickRandom(filteredList);
  question_input.innerText = current.q;
  inputAnswer.value = "";
  inputAnswer.focus();
  exampleInput.style.display = "none";
  exampleInput.innerHTML = "";
}

document.getElementById("inputCheck").onclick = ()=>{
  if(!current) return;
  total++;
  const user = inputAnswer.value.trim().toLowerCase();
  const real = current.a.toLowerCase();

  if(user === real){
    correct++;
    flash("inputMode","correctFlash");
  } else {
    wrong++;
    flash("inputMode","wrongFlash");
    addMistake(current.id || current.q);
  }
  showExample(exampleInput);
  saveStats();
};

document.getElementById("inputNext").onclick = newInputQuestion;

// æ–‡å­—ãƒœã‚¿ãƒ³
document.querySelectorAll(".tr-keys button").forEach(btn=>{
  btn.onclick = ()=>{
    inputAnswer.value += btn.textContent;
    inputAnswer.focus();
  };
});

// =====================
//  è‹¦æ‰‹å•é¡Œãƒ¢ãƒ¼ãƒ‰
// =====================
function addMistake(key){
  if(!mistakeList.includes(key)){
    mistakeList.push(key);
    localStorage.setItem("conj_mistakeList", JSON.stringify(mistakeList));
  }
}

function newMistakeQuestion(){
  if(mistakeList.length === 0){
    mistakeInfo.innerHTML = "<p>ğŸ‰ ç¾åœ¨ã€ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹è‹¦æ‰‹å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
    mistakeQuestion.innerHTML = "";
    mistakeChoices.innerHTML = "";
    exampleMistake.style.display = "none";
    exampleMistake.innerHTML = "";
    return;
  }

  const key = pickRandom(mistakeList);
  current = vocab.find(v => (v.id || v.q) === key);

  if(!current){
    mistakeList = mistakeList.filter(x=>x !== key);
    localStorage.setItem("conj_mistakeList", JSON.stringify(mistakeList));
    newMistakeQuestion();
    return;
  }

  mistakeInfo.innerHTML = `<p>è‹¦æ‰‹å•é¡Œæ•°ï¼š${mistakeList.length}</p>`;
  mistakeQuestion.innerText = current.q;
  exampleMistake.style.display = "none";
  exampleMistake.innerHTML = "";

  const arr = [current.a, ...current.c].sort(()=>Math.random()-0.5);
  mistakeChoices.innerHTML = "";
  arr.forEach(ans=>{
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.innerText = ans;
    btn.onclick = ()=>checkMistake(ans, key);
    mistakeChoices.appendChild(btn);
  });
}

function checkMistake(ans, key){
  total++;
  if(ans === current.a){
    correct++;
    mistakeList = mistakeList.filter(x=>x !== key);
    localStorage.setItem("conj_mistakeList", JSON.stringify(mistakeList));
    flash("mistakeMode","correctFlash");
  } else {
    wrong++;
    flash("mistakeMode","wrongFlash");
  }
  showExample(exampleMistake);
  saveStats();
}

document.getElementById("mistakeNext").onclick = newMistakeQuestion;

// =====================
//  æ–‡æ³•å½¢ãƒ•ã‚£ãƒ«ã‚¿
// =====================
document.getElementById("filterStart").onclick = ()=>{
  const p = posSelect.value;
  if(p === "all") filteredList = [...vocab];
  else filteredList = vocab.filter(v => v.pos === p);

  alert("ãƒ•ã‚£ãƒ«ã‚¿å®Œäº†ï¼é¸ã‚“ã æ–‡æ³•å½¢ã ã‘å‡ºé¡Œã—ã¾ã™ã€‚");
  showTab("choice");
  newQuestion();
};

// =====================
//  Stats
// =====================
function saveStats(){
  localStorage.setItem("conj_total", total);
  localStorage.setItem("conj_correct", correct);
  localStorage.setItem("conj_wrong", wrong);
}

function drawStats(){
  stat_total.innerText   = "ç·å›ç­”æ•°ï¼š" + total;
  stat_correct.innerText = "æ­£è§£ï¼š" + correct;
  stat_wrong.innerText   = "ä¸æ­£è§£ï¼š" + wrong;
  const rate = (correct/(total||1)*100).toFixed(1);
  stat_rate.innerText    = "æ­£ç­”ç‡ï¼š" + rate + "%";

  stat_mistake.innerHTML = "";
  mistakeList.slice(0,10).forEach(key=>{
    const li = document.createElement("li");
    const item = vocab.find(v => (v.id || v.q) === key);
    li.innerText = item ? item.q : key;
    stat_mistake.appendChild(li);
  });
}

// =====================
//  Start
// =====================
newQuestion();
</script>

</body>
</html>
